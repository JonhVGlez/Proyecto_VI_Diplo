---
title: "Untitled"
author: "Jonathan Vargas"
date: "2025-08-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
tidymodels_prefer()
```


```{r, message=FALSE, warning=FALSE, results = "hide"}
# UMAP sin valores de los hiper-parametros
df_umap <- df %>%
  dplyr::select(where(is.numeric)) %>%
  scale() %>%
  umap()
```

```{r, message=FALSE, warning=FALSE, echo = FALSE}
#Base de datos
datos<-data.frame(UMAP1=df_umap[,1],UMAP2=df_umap[,2],Potability=df$Potability)

ggplot(datos, aes(x = UMAP1, y = UMAP2, color = Potability)) +
  geom_point(size = 2) +
    scale_color_manual(values = c("0" = "#ec7d15", "1" = "#10b9ec")) +
  labs(title="Potabilidad: UMAP")
```

Argumentos de esta función:

* n_neighbors
* n_components
* metric
* n_epochs
* learning_rate

### UMAP: Exploracion de hiperparámetros

```{r, message=FALSE, warning=FALSE, results = "hide"}
umap_params1 = expand.grid(n_neighbors = c(10, 20, 50, 100, 150, 200),min_dist = c(0.5, 0.75, 1.1))

umaps = lapply(seq(nrow(umap_params1)), function(i) {
    emb = umap(
      X = df[,-1],
      n_neighbors = umap_params1$n_neighbors[i],
      min_dist  = umap_params1$min_dist[i])

  return(emb)
})
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
d1 = rbindlist(lapply(seq(nrow(umap_params1)), function(i) {
  data.table(
    x = umaps[[i]][,1],
    y = umaps[[i]][,2],
    n_neighbors = umap_params1$n_neighbors[i],
    min_dist = umap_params1$min_dist[i],
    Potability = as.factor(df$Potability)
  )
}))
```


```{r, message=FALSE, warning=FALSE, echo=FALSE}
p1<-ggplot(d1) +
  geom_scattermore(
    mapping = aes(x = x, y = y,,colour=Potability),
    pointsize = 2
  ) +
  theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank(),
    legend.position = "none"
  ) +
  facet_wrap(min_dist ~ n_neighbors ,
             labeller = label_both,
             scales = "free") +
  theme_bw() +
  labs(title = "WDBC: UMAP")

p1
```

**Los gifs con las animaciones se incluyen en la carpeta de envío.**

```{r, message=FALSE, warning=FALSE, include=FALSE}
colores = c("0" = "#ec7d15","1" = '#10b9ec')

anim_plot1<-d1 %>% 
  filter(n_neighbors == 10 | n_neighbors == 20 | n_neighbors == 50 | n_neighbors == 100 | n_neighbors == 150 | n_neighbors == 200) %>% 
  mutate(parametros = factor(paste('n_neighbors:', n_neighbors, 'min_dist:', min_dist))) %>% ggplot() +
  geom_scattermore(
    mapping = aes(x = x, y = y, col = Potability),
    pointsize = 2
  ) +
  theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank(),
    legend.position = "none"
  ) +
  theme_bw()+
  labs(title = 'Verificación de los parámetros')+
  scale_color_manual(values = colores) + 
  transition_states(parametros, transition_length = 2, state_length = 3) +
  labs(title = '{closest_state}')

animate(anim_plot1, nframes = 300)
anim_save("gifUMAP1.gif")
```


### Conclusión UMAP

En los distintos casos de hiperparámetros podemos observar que con este método de reducción de dimensiones tampoco fue posible separar reducir la dimensión de los datos ni separar los grupos de potabilidad.

## Conclusión.

En los tres métodos presentados no fue posible reducir la dimensión de los datos. Esto se puede deber a la baja correlación de las distintas variables. Esto podría ser un indicio de independencia de las variables, mostrando que cada variable aporta algo distinto e igualmente importante a la clasificación en la potabilidad.