---
title: "PROYECTO TSNE"
author: "Jonathan Vargas"
date: "2025-08-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

A continuación vamos a hacer uso del algoritmo t-SNE ya que, como vimos en el método de PCA, con el paquete `Rtsne`.
```{r, message=FALSE, warning=FALSE}
set.seed(123)

df_Rtsne <- df %>%
  dplyr::select(where(is.numeric)) %>%
  scale() %>%
  Rtsne()
```

**Agregando los resultados de  t-SNE a la base:**

```{r, warning=FALSE, message=FALSE}
datos1<-data.frame(Rtsne1=df_Rtsne$Y[,1],Rtsne2=df_Rtsne$Y[,2],Potability=df$Potability)
```

```{r, warning=FALSE, message=FALSE, echo=FALSE}
ggplot(datos1,aes(x=Rtsne1,y=Rtsne2,color=Potability))+
  geom_point(size=1.5) +
  scale_color_manual(values = c("0" = "#ec7d15", "1" = "#10b9ec")) +
  labs(title="Potabilidad: Rtsne")

```
Podemos observar que aplicando Rtsne no se ve una separación de los grupos.

Veamos ahora aplicando la misma función pero modificando hiperparámetros: perplexity y la tasa de aprendizaje.
* perplexity: Con los valores de 10, 15, 20, 25 30,
* Tasa de aprendizaje: con los valores de 10, 50, 100, 150.

```{r, message=FALSE, warning=FALSE, results = "hide"} 
set.seed(123)
Rtsne_params2 = expand.grid(perplexity=c(10,15,20,25,30), eta = c(10, 50, 100, 150))

Rtsne_res2 = lapply(seq(nrow(Rtsne_params2)), function(i) {
  print(i)
  Rres = Rtsne(
    X = df[,-1],
    max_iter = 500,
    verbose=TRUE,
    perplexity = Rtsne_params2$perplexity[i],
    check_duplicates = FALSE,
    eta = Rtsne_params2$eta[i],
    pca = F
  )
  return(Rres)
})
```

```{r, message=FALSE, warning=FALSE, echo=FALSE}

d3 = rbindlist(lapply(seq(nrow(Rtsne_params2)), function(i) {
  data.table(
    x = Rtsne_res2[[i]]$Y[,1],
    y = Rtsne_res2[[i]]$Y[,2],
    perplexity = Rtsne_params2[[1]][i],
    eta = Rtsne_params2[[2]][i],
    Potability = df$Potability
  )
}))

p3<-ggplot(d3) +
  geom_scattermore(
    mapping = aes(x = x, y = y ,colour=Potability),
    pointsize = 2
  ) +
  scale_colour_manual(values = c("0" = "#ec7d15", "1" = "#10b9ec")) +
  theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank(),
    legend.position = "none"
  ) +
  facet_wrap(eta~perplexity ,
             labeller = label_both,
             scales = "free",
             ncol = 5) +
  labs(title = "t-SNE con distinta Perplexities y tasa de aprendizaje", x = "Rtsne1", y = "Rtsne2") +
  theme_bw() 
p3
```

**El gif con la animación se incluye en la carpeta de envío.**

```{r, message=FALSE, warning=FALSE, include =FALSE}
colores = c("0" = "#ec7d15","1" = '#10b9ec')
# names(colores) = c("0","1")

anim_plot1<-d3 %>% 
  filter(perplexity == 10 | perplexity == 15 | perplexity == 20 | perplexity == 25 | perplexity == 30) %>% 
  mutate(parametros = factor(paste('perplexity:', perplexity, 'eta:', eta))) %>% ggplot() +
  geom_scattermore(
    mapping = aes(x = x, y = y, col = Potability),
    pointsize = 2
  ) +
  theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    axis.title = element_blank(),
    legend.position = "none"
  ) +
  theme_bw()+
  labs(title = 'Verificación de los parámetros')+
  scale_color_manual(values = colores) + 
  transition_states(parametros, transition_length = 2, state_length = 3) +
  labs(title = '{closest_state}')

animate(anim_plot1, nframes = 300)
anim_save("gifTsne1.gif")
```

### Conclusión t-SNE
En los distintos casos de hiperparámetros podemos observar que con este método de reducción de dimensiones tampoco fue posible separar reducir la dimensión de los datos ni separar los grupos de potabilidad.